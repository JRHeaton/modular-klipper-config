[gcode_macro autotune_pids]
gcode:
  {% set BED_TEMP = params.BED|default(60)|int %}
  {% set EXTRUDER_TEMP = params.E|default(200)|int %}

  {% set min_bed_temp = printer.configfile.settings.heater_bed.min_temp %}
  {% set max_bed_temp = printer.configfile.settings.heater_bed.max_temp %}
  {% set min_ext_temp = printer.configfile.settings.extruder.min_temp %}
  {% set max_ext_temp = printer.configfile.settings.extruder.max_temp %}

  {% if BED_TEMP < min_bed_temp or BED_TEMP > max_bed_temp %}
    { action_raise_error("BED_TEMP must be between %d and %d" % (min_bed_temp, max_bed_temp)) }
  {% endif %}
  {% if EXTRUDER_TEMP < min_ext_temp or EXTRUDER_TEMP > max_ext_temp %}
    { action_raise_error("EXTRUDER_TEMP must be between %d and %d" % (min_ext_temp, max_ext_temp)) }
  {% endif %}

  PID_CALIBRATE heater=heater_bed target={BED_TEMP}
  PID_CALIBRATE heater=extruder target={EXTRUDER_TEMP}
