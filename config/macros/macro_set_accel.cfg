[gcode_macro SET_ACCEL]
variable_decel_factor: 0.5
description: "Set acceleration and deceleration (by way of deceleration factor [0-1])"
gcode:
  {% if 'ACCEL' not in params %}
    { action_raise_error("Must provide ACCEL param") }
  {% endif %}
  
  {% set decel_factor = params.DECEL_FACTOR|default(decel_factor)|float %}
  {% if decel_factor < 0 or decel_factor > 1 %}
    { action_raise_error("DECEL_FACTOR must be between 0 and 1") }
  {% endif %}

  SET_GCODE_VARIABLE MACRO=SET_ACCEL VARIABLE=decel_factor VALUE={decel_factor}
  SET_VELOCITY_LIMIT accel={params.ACCEL} accel_to_decel={params.ACCEL|float * decel_factor}