[gcode_macro prime_nozzle]
gcode:
  {% set vfr = 5 %}
  {% set nozzle_diameter = printer.configfile.settings.extruder.nozzle_diameter %}
  {% set layer_height = nozzle_diameter * 0.75 %}
  {% set cross_sectional_area = 3.14159*(printer.configfile.settings.extruder.filament_diameter / 2)**2 %}
  {% set extrusion_width = nozzle_diameter * 1.4 %}
  {% set line_sectional_area = extrusion_width * layer_height %}
  {% set line_to_filament_ratio = line_sectional_area / cross_sectional_area %}

  M83
  {% set line_length = 190 %}
  G1 Z{layer_height + 5}
  G1 X{10} Y{5} Z{layer_height} F6000
  G1 Y{5 + line_length} E{line_length * line_to_filament_ratio} F2000
  G1 X8
  G1 Y5 E{line_length * line_to_filament_ratio}
  Gt X30 Y30 F6000
  G1 Z50 F3000